getwd()
setwd("/Users/miss_viktoriia/Documents/CheapTrip/Git_project_validation/Trips-Validation")
bus <- read_excel("Datasets/bus_for_labeling.xlsx") %>%
select(from_id,
to_id,
price_min_EUR,
duration_min,
distance_km,
frequency_tpw,
Outcome) %>%
filter(!is.na(Outcome))
library(tidyverse)
library(readxl)
library(caret)
library(mlr)
library(doParallel)
library(parallelMap)
library(GGally)
library(DataExplorer)
library(corrplot)
library(isotree)
bus <- read_excel("Datasets/bus_for_labeling.xlsx") %>%
select(from_id,
to_id,
price_min_EUR,
duration_min,
distance_km,
frequency_tpw,
Outcome) %>%
filter(!is.na(Outcome))
summary(bus)
countries <- read_excel("Datasets/locations_with_id.xlsx",
range = "A1:H775",
col_names = FALSE) %>%
rename(id_city = ...1,
city = ...2,
id_country = ...3,
country = ...8,
latitude = ...4,
longitude = ...5) %>%
select(id_city,
city,
id_country,
country,
latitude,
longitude)
locations_from <- countries %>%
rename(from_id = id_city, from_city = city,
from_country_id = id_country, from_country = country,
from_latitude = latitude, from_longitude = longitude)
locations_to <- countries %>%
rename(to_id = id_city, to_city = city,
to_country_id = id_country, to_country = country,
to_latitude = latitude, to_longitude = longitude)
connection_from <- left_join(bus, locations_from, by = c("from_id" = "from_id"))
connection_to <- left_join(connection_from, locations_to, by = c("to_id" = "to_id"))
bus_for_modeling <- connection_to %>%
select(price_min_EUR,
duration_min,
distance_km,
frequency_tpw,
from_latitude,
from_longitude,
to_latitude,
to_longitude,
Outcome)
bus_for_modeling$Outcome <- as.factor(bus_for_modeling$Outcome)
summary(bus_for_modeling)
scale_lat_from <- preProcess(bus_for_modeling[,5], method = "range",
rangeBounds = c(0.61, 1.01))
bus_for_modeling[,5] <- predict(scale_lat_from, newdata = bus_for_modeling[,5])
scale_lat_to <- preProcess(bus_for_modeling[,7], method = "range",
rangeBounds = c(0.61, 1.09))
bus_for_modeling[,7] <- predict(scale_lat_to, newdata = bus_for_modeling[,7])
scale_long_from <- preProcess(bus_for_modeling[,6], method = "range",
rangeBounds = c(-0.15, 0.48))
bus_for_modeling[,6] <- predict(scale_long_from, newdata = bus_for_modeling[,6])
scale_long_to <- preProcess(bus_for_modeling[,8], method = "range",
rangeBounds = c(-0.15, 0.46))
bus_for_modeling[,8] <- predict(scale_long_to, newdata = bus_for_modeling[,8])
set.seed(333)
ind <- createDataPartition(bus_for_modeling$Outcome, p = .8, list = FALSE)
train <- bus_for_modeling[ ind,]
test  <- bus_for_modeling[-ind,]
train_alter <- train
test_alter <- test
plot_histogram(train)
plot_density(train)
scale <- preProcess(train[,c(1:4)], method = c("center", "scale"))
train[,c(1:4)] <- predict(scale, newdata = train[,c(1:4)])
test[,c(1:4)] <- predict(scale, newdata = test[,c(1:4)])
summary(train)
levels(train$Outcome) <- c("V", "I")
getwd()
bus_valid <- read_excel("buses_valid_trips.xlsx")
#-------------------------------------------------------------------------------
bus_valid <- read_excel("Datasets/buses_valid_trips.xlsx")
bus_valid <- read_excel("Datasets/buses_valid_trips.xlsx")
bus_invalid <- read_excel("Datasets/buses_invalid_trips.xlsx")
bus_valid <- read_excel("Datasets/buses_valid_trips.xlsx")
bus_invalid <- read_excel("Datasets/buses_invalid_trips.xlsx")
bus <- rbind(bus_valid, bus_invalid)
countries <- read_excel("Datasets/locations_with_id.xlsx",
range = "A1:H775",
col_names = FALSE) %>%
rename(id_city = ...1,
city = ...2,
id_country = ...3,
country = ...8,
latitude = ...4,
longitude = ...5) %>%
select(id_city,
city,
id_country,
country,
latitude,
longitude)
locations_from <- countries %>%
rename(from_id = id_city, from_city = city,
from_country_id = id_country, from_country = country,
from_latitude = latitude, from_longitude = longitude)
locations_to <- countries %>%
rename(to_id = id_city, to_city = city,
to_country_id = id_country, to_country = country,
to_latitude = latitude, to_longitude = longitude)
connection_from <- left_join(bus, locations_from, by = c("from_id" = "from_id"))
connection_to <- left_join(connection_from, locations_to, by = c("to_id" = "to_id"))
bus <- connection_to %>%
select(price_min_EUR,
duration_min,
distance_km,
from_latitude,
from_longitude,
to_latitude,
to_longitude,
Predicted_Outcome)
bus_for_modeling <- bus
summary(bus_for_modeling)
bus_for_modeling <- bus_for_modeling %>%
mutate(log_price = log(price_min_EUR),
log_duration = log(duration_min),
log_dist = log(distance_km)) %>%
select(-price_min_EUR,
-duration_min,
-distance_km)
summary(bus_for_modeling)
lat <- preProcess(bus_for_modeling[,c(1,3)], method = "range",
rangeBounds = c(0.49, 1.01))
bus_for_modeling[,c(1,3)] <- predict(lat, newdata = bus_for_modeling[,c(1,3)])
long <- preProcess(bus_for_modeling[,c(2,4)], method = "range",
rangeBounds = c(-0.15, 0.66))
bus_for_modeling[,c(2,4)] <- predict(long, newdata = bus_for_modeling[,c(2,4)])
valid <- bus_for_modeling %>%
filter(Predicted_Outcome == 0) %>%
select(-Predicted_Outcome)
invalid <- bus_for_modeling %>%
filter(Predicted_Outcome == 1) %>%
select(-Predicted_Outcome)
set.seed(147)
i <- createDataPartition(valid$log_price, p = .8, list = FALSE)
train <- valid[ i,]
test  <- valid[-i,]
scale_logs <- preProcess(train[, c(6,7)], method = c("center", "scale"))
train[,c(6,7)] <- predict(scale_logs, newdata = train[,c(6,7)])
test[,c(6,7)] <- predict(scale_logs, newdata = test[,c(6,7)])
invalid[,c(6,7)] <- predict(scale_logs, newdata = invalid[,c(6,7)])
plot_histogram(train)
plot_density(train)
plot_correlation(train)
ggpairs(train[, c(1:7)])
ggplot(data = train, aes(x = log_duration, y = log_price)) +
geom_point()
ggplot(data = train, aes(x = log_dist, y = log_price)) +
geom_point()
